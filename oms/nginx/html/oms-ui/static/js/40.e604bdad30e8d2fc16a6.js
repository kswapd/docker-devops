webpackJsonp([40],{Fl2g:function(t,a){},SqiR:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("INCx"),i=e.n(s),l=e("mvHQ"),n=e.n(l),r=e("fZjL"),o=e.n(r),c=e("4ru3"),d=e("4CZg"),p=e("hpoG"),m={name:"zipkinSaved",data:function(){return{addForm:{savePath:"",Describe:""},that:this,options:[],detailForm:{lookback:"",seviceNum:"",depth:"",spanNum:""},savedData:{},mainData:{serviceCounts:[]},tableVisible:!1,dialogVisible:!1,diglogTitle:"",dialogTable:{serviceName:"",annotations:[],binaryAnnotations:[],spanId:"",parentId:""}}},computed:{},watch:{},mounted:function(){},methods:{handleChange:function(t){this.options=[],this.detailForm={lookback:"",seviceNum:"",depth:"",spanNum:""},this.savedData={},this.mainData={serviceCounts:[]};var a=this,e=t.target.files[0],s=new FileReader;s.onload=function(e){try{var s=JSON.parse(e.target.result).map(c.a.convert),i=c.a.mergeById(s),l=d.a.correctForClockSkew(i),r=Object(p.a)(l,"");a.tableVisible=!0,a.addForm.savePath=t.target.value,a.detailForm={lookback:r.duration,seviceNum:r.services,depth:r.depth,spanNum:r.totalSpans},o()(r.spans).forEach(function(t){r.spans[t].spread=!0,r.spans[t].spreadStatus=!0}),a.savedData=JSON.parse(n()(r)),a.mainData=r.spans,a.savedData.serviceCounts.forEach(function(t){a.options.push({value:t.name,label:t.name})})}catch(t){a.$message({type:"warning",message:"数据错误或者格式不对"})}},setTimeout(function(){return s.readAsText(e)},0)},checkHandle:function(t){this.diglogTitle=t.spanName+":"+t.durationStr,this.dialogTable={serviceName:t.serviceName,annotations:t.annotations,binaryAnnotations:t.binaryAnnotations,spanId:t.spanId,parentId:t.parentId},this.dialogVisible=!0},handleItemChange:function(t){var a=JSON.parse(n()(this.savedData.spans));if(!t.length>0)this.mainData=a;else{var e=[];a.forEach(function(a){t.forEach(function(t){t===a.serviceName&&e.push(a)})}),this.mainData=e}},spreadHandle:function(t,a){t.stopPropagation();var e=this.mainData.indexOf(a);if(!1===a.spread){this.$set(this.mainData[e],"spread",!0);for(var s=e+1;s<this.mainData.length&&this.mainData[s].depthClass>this.mainData[e].depthClass;s++)this.mainData[s].spread=!0,this.mainData[s].spreadStatus=!0}else{this.$set(this.mainData[e],"spread",!1);for(var i=e+1;i<this.mainData.length&&this.mainData[i].depthClass>this.mainData[e].depthClass;i++)this.mainData[i].spreadStatus=!1}}},filters:{timeFilter:function(t,a){return a.$moment(i()(t/1e3)).format("YYYY-MM-DD hh:mm:ss a")},shortWords:function(t){var a=t.serviceName;return a?a.length>16?a.slice(0,15)+"...":a:t.depthClass+"-"+a}}},v={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"zipkinSaved"},[e("el-container",{staticClass:"detailZipkin"},[e("div",{staticClass:"button-group"},[e("span",{staticClass:"route-name"},[t._v(t._s(t.$route.meta.title))])]),t._v(" "),e("el-header",{staticStyle:{width:"100%",height:"100%"}},[e("el-form",{ref:"addForm",attrs:{model:t.addForm,"status-icon":"","label-width":"0px",size:"small"}},[e("el-form-item",[e("el-row",{attrs:{gutter:10}},[e("el-col",{staticStyle:{position:"relative"},attrs:{span:12}},[e("el-col",{attrs:{span:19}},[e("el-input",{attrs:{placeholder:"请选择文件(.txt/.json)"},model:{value:t.addForm.savePath,callback:function(a){t.$set(t.addForm,"savePath",a)},expression:"addForm.savePath"}})],1),t._v(" "),e("el-col",{attrs:{span:5}},[e("input",{staticClass:"input-file",attrs:{type:"file",accept:"text/plain, application/json"},on:{change:function(a){t.handleChange(a)}}}),t._v(" "),e("el-button",{attrs:{type:"primary",size:"small"}},[t._v(t._s(t.$t("common.viewFile")))])],1)],1)],1)],1)],1),t._v(" "),t.tableVisible?e("div",{key:"zipkinHeader"},[e("el-row",{staticClass:"clearfix",attrs:{type:"flex",justify:"middle"}},[e("el-col",{staticClass:"header-lf",attrs:{span:2}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"调用链总耗时",placement:"top"}},[e("el-button",[t._v(t._s(t.$t("zipkin.duration")+"："))])],1)],1),t._v(" "),e("el-col",{staticClass:"header-rt",attrs:{span:2}},[e("el-tag",{staticClass:"button-new-tag",attrs:{size:"mini"}},[t._v(t._s(t.detailForm.lookback))])],1),t._v(" "),e("el-col",{staticClass:"header-lf",attrs:{span:2}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"涉及的服务总数",placement:"top"}},[e("el-button",[t._v(t._s(t.$t("zipkin.serviceNum")+"："))])],1)],1),t._v(" "),e("el-col",{staticClass:"header-rt",attrs:{span:2}},[e("el-tag",{staticClass:"button-new-tag",attrs:{size:"mini"}},[t._v(t._s(t.detailForm.seviceNum))])],1),t._v(" "),e("el-col",{staticClass:"header-lf",attrs:{span:2}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"调用的深度",placement:"top"}},[e("el-button",[t._v(t._s(t.$t("zipkin.depth")+"："))])],1)],1),t._v(" "),e("el-col",{staticClass:"header-rt",attrs:{span:2}},[e("el-tag",{staticClass:"button-new-tag",attrs:{size:"mini"}},[t._v(t._s(t.detailForm.depth))])],1),t._v(" "),e("el-col",{staticClass:"header-lf",staticStyle:{"min-width":"83px"},attrs:{span:2}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"调用spansd的总数量",placement:"top"}},[e("el-button",[t._v(t._s(t.$t("zipkin.spansNum")+"："))])],1)],1),t._v(" "),e("el-col",{staticClass:"header-rt",attrs:{span:2}},[e("el-tag",{staticClass:"button-new-tag",attrs:{size:"mini"}},[t._v(t._s(t.detailForm.spanNum))])],1)],1),t._v(" "),e("el-row",[e("el-col",{attrs:{span:4}},[e("div",{staticClass:"block"},[e("el-cascader",{attrs:{size:"mini",placeholder:"搜索",options:t.options,filterable:"",clearable:""},on:{change:t.handleItemChange}})],1)])],1),t._v(" "),e("el-row",[e("el-col",{attrs:{span:12}},[t.savedData.serviceCounts&&t.savedData.serviceCounts.length>0?e("div",t._l(t.savedData.serviceCounts,function(a){return e("span",{key:a.id,staticClass:"zipList",staticStyle:{"margin-right":"10px"}},[t._v("\n                               "+t._s(a.name+" x"+a.count+" "+a.max+"ms")+"\n                           ")])})):t._e()])],1)],1):t._e()],1),t._v(" "),t.tableVisible?e("el-main",[t.savedData.timeMarkers&&t.savedData.timeMarkers.length>0?e("el-row",[e("el-col",{attrs:{span:4}},[e("el-tag",{staticStyle:{"margin-left":"10px"},attrs:{size:"small"}},[t._v(t._s(t.$t("zipkin.serviceName")))])],1),t._v(" "),t._l(t.savedData.timeMarkers,function(a){return e("el-col",{key:a.id,attrs:{span:4,align:"right"}},[a.time?e("el-tag",{attrs:{size:"small"}},[t._v(t._s(a.time))]):t._e()],1)})],2):t._e(),t._v(" "),t._l(t.mainData,function(a){return a.spreadStatus?e("el-row",{key:a.id,staticClass:"main-box"},[e("div",{staticStyle:{width:"100%",height:"23px"},on:{click:function(e){t.checkHandle(a)}}},[e("el-col",{staticClass:"main-title",attrs:{span:4}},[e("div",{staticClass:"main-title-box",style:{"margin-left":10*a.depthClass+5+"px"}},[""!==a.children?e("el-button",{staticClass:"main-add",on:{click:function(e){t.spreadHandle(e,a)}}},[t._v(t._s(a.spread?"-":"+"))]):t._e(),t._v(" "),e("el-tooltip",{attrs:{content:a.serviceName,placement:"top"}},[e("el-button",{attrs:{size:"mini"}},[t._v(t._s(t._f("shortWords")(a)))])],1)],1)]),t._v(" "),e("el-col",{staticClass:"main-content",staticStyle:{position:"relative"},attrs:{span:20}},[e("el-button",{style:{position:"absolute",left:a.left+"%"},attrs:{size:"mini"}},[t._v(t._s(a.durationStr+" "+a.spanName))])],1)],1)]):t._e()})],2):t._e(),t._v(" "),e("el-dialog",{staticClass:"diglogBox",attrs:{visible:t.dialogVisible,width:"60%"},on:{"update:visible":function(a){t.dialogVisible=a}}},[e("span",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[e("span",[t._v(t._s(t.diglogTitle))])]),t._v(" "),e("span",{staticClass:"service"},[t._v(t._s(t.$t("zipkin.serviceName"))+" ： "+t._s(t.dialogTable.serviceName))]),t._v(" "),e("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"24px"},attrs:{stripe:"",data:t.dialogTable.annotations}},[e("el-table-column",{attrs:{align:"center",label:t.$t("zipkin.dateTime")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticClass:"zipList"},[t._v(t._s(t._f("timeFilter")(a.row.timestamp,t.that)))])]}}])}),t._v(" "),e("el-table-column",{attrs:{align:"center",width:"150px",prop:"relativeTime",label:t.$t("zipkin.relativeTime")}}),t._v(" "),e("el-table-column",{attrs:{align:"center",width:"200px",prop:"value",label:t.$t("zipkin.annotation")}}),t._v(" "),e("el-table-column",{attrs:{align:"center",prop:"endpoint",label:t.$t("zipkin.address")}})],1),t._v(" "),e("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"24px"},attrs:{stripe:"",data:t.dialogTable.binaryAnnotations}},[e("el-table-column",{attrs:{align:"center",prop:"key",label:t.$t("zipkin.key")}}),t._v(" "),e("el-table-column",{attrs:{align:"center",prop:"value",label:t.$t("zipkin.value")}})],1),t._v(" "),e("el-collapse",{attrs:{accordion:""}},[e("el-collapse-item",{attrs:{title:t.$t("zipkin.moreInfo")}},[e("table",{staticClass:"table"},[e("tbody",[e("tr",[e("td",{staticClass:"key",attrs:{"data-key":"key"}},[t._v("traceId")]),t._v(" "),e("td",{staticClass:"value",attrs:{"data-key":"value"}},[t._v(t._s(t.savedData.traceId))])]),t._v(" "),e("tr",[e("td",{staticClass:"key",attrs:{"data-key":"key"}},[t._v("spanId")]),t._v(" "),e("td",{staticClass:"value",attrs:{"data-key":"value"}},[t._v(t._s(t.dialogTable.spanId))])]),t._v(" "),e("tr",[e("td",{staticClass:"key",attrs:{"data-key":"key"}},[t._v("parentId")]),t._v(" "),e("td",{staticClass:"value",attrs:{"data-key":"value"}},[t._v(t._s(t.dialogTable.parentId))])])])])])],1)],1)],1)],1)},staticRenderFns:[]};var u=e("VU/8")(m,v,!1,function(t){e("Fl2g")},"data-v-3c8985b9",null);a.default=u.exports}});
//# sourceMappingURL=40.e604bdad30e8d2fc16a6.js.map