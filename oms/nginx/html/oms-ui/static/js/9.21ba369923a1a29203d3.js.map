{"version":3,"sources":["webpack:///src/components/zipkin/transactionDetails.vue","webpack:///./src/components/zipkin/transactionDetails.vue?73c8","webpack:///./src/components/zipkin/transactionDetails.vue"],"names":["transactionDetails","name","data","that","this","loading","tableBoxParams","inputRules","startTs","required","message","trigger","endTs","serviceName","sourceType","limit","pattern","searchFrom","Date","getTime","lookback","zipkinData","zipkinTable","computed","ApiQuery","query","assign_default","String","keys_default","forEach","key","mounted","methods","searchHandle","vm","$refs","validate","valid","searchAxios","$message","type","param","tableParams","_this","$axios","get","Api","zipkinDetailtrace","params","then","res","length","undefined","traces","JSON","parse","stringify_default","summaries","map","raw","v1Trace","spanConverter","convert","mergedTrace","mergeById","clockSkewCorrectedTrace","skew","correctForClockSkew","Object","traceSummary","traceParameter","value","parameter","annotationsFilter","time","Array","isArray","item","valueName","timestamp","$moment","trunc_default","format","sortHandle","tranTimestamp","traceSeqNo","seqNo","serviceCode","retCode","retMsg","cs","annotations","ss","catch","error","arr","val","sortFunctions","Service-Percentage:Longest-First","a","b","percentage","Service-Percentage:Shortest-First","Longest-First","duration","Shortest-First","Newest-First","Oldest-First","hasOwnProperty","sort","handleDownload","_this2","downloadLoading","__webpack_require__","e","bind","excel","list","formatJson","export_json_to_excel","header","filename","autoWidth","filterVal","jsonData","v","j","zipkin_transactionDetails","render","_vm","_h","$createElement","_c","_self","staticClass","_v","_s","$route","meta","title","staticStyle","width","height","ref","attrs","model","label-width","rules","label-position","size","gutter","xl","lg","label","$t","prop","placeholder","callback","$$v","$set","expression","clearable","maxlength","trim","min-width","on","click","$event","directives","rawName","stripe","align","scopedSlots","_u","fn","props","row","staticRenderFns","Component","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/9.21ba369923a1a29203d3.js","sourcesContent":["<!-- transactionDetails 交易详情-->\n<template>\n  <div class=\"transactionDetails\">\n    <div class=\"button-group\">\n        <span class=\"route-name\">{{$route.meta.title}}</span>\n    </div>\n     <div class=\"header\" style=\"width:100%;height:100%\">\n        <el-form ref=\"searchFrom\" :model=\"searchFrom\" label-width=\"82px\" :rules=\"inputRules\" label-position=\"left\" size=\"small\">\n            <el-row :gutter=\"12\">\n                <el-col :xl=\"4\" :lg=\"6\">\n                    <el-form-item :label=\"$t('common.startDate')+'：'\" label-width=\"92px\" prop=\"startTs\">\n                        <el-date-picker v-model=\"searchFrom.startTs\" type=\"datetime\" :placeholder=\"$t('common.selectDate')\" style=\"width: 100%;\"></el-date-picker>\n                    </el-form-item>\n                </el-col>\n                <el-col :xl=\"4\" :lg=\"6\">\n                    <el-form-item :label=\"$t('common.endDate')+'：'\" label-width=\"92px\" prop=\"endTs\">\n                        <el-date-picker v-model=\"searchFrom.endTs\" type=\"datetime\" style=\"width: 100%;\" :placeholder=\"$t('common.selectDate')\"></el-date-picker>\n                    </el-form-item>\n                </el-col>\n                <el-col :xl=\"4\" :lg=\"6\">\n                    <el-form-item :label=\"'服务名：'\" label-width=\"70px\">\n                        <el-input clearable v-model.trim=\"searchFrom.serviceName\" placeholder=\"eg: MBSD_GA-1400-0101\" type=\"text\" maxlength=\"25\"></el-input>\n                    </el-form-item>\n                </el-col>\n                <el-col :xl=\"4\" :lg=\"6\">\n                    <el-form-item :label=\"'渠道：'\" label-width=\"56px\">\n                        <el-input clearable v-model.trim=\"searchFrom.sourceType\" placeholder=\"eg: MT\" type=\"text\" maxlength=\"25\"></el-input>\n                    </el-form-item>\n                </el-col>\n            </el-row>\n            <el-row :gutter=\"12\">\n                <el-col :xl=\"4\" :lg=\"6\">\n                    <el-form-item :label=\"'查询数量：'\" label-width=\"92px\" prop=\"limit\">\n                        <el-input clearable v-model.trim=\"searchFrom.limit\" type=\"text\" maxlength=\"25\"></el-input>\n                    </el-form-item>\n                </el-col>\n                <el-col :xl=\"3\" :lg=\"3\" style=\"min-width:155px\">\n                    <el-form-item :label=\"''\" label-width=\"0px\">\n                        <el-button type=\"primary\" size=\"small\" @click=\"searchHandle()\">{{$t('common.search')}}</el-button>\n                        <el-button type=\"primary\" size=\"small\" @click=\"handleDownload()\">下载</el-button>\n                    </el-form-item>\n                </el-col>\n            </el-row>\n        </el-form>\n    </div>\n    <!-- 表格部分 -->\n    <div>\n        <el-table\n            stripe\n            v-loading=\"loading\"\n            :data=\"zipkinTable\"\n            size=\"small\"\n            ref=\"multipleTable\"\n            style=\"width: 100%\">\n            <el-table-column\n                align=\"center\"\n                width=\"100\"\n                prop=\"traceSeqNo\"\n                :label=\"'时间戳'\">\n                <template slot-scope=\"props\">\n                    {{props.row.tranTimestamp}}\n                </template>\n            </el-table-column>\n            <el-table-column\n                align=\"center\"\n                width=\"100\"\n                prop=\"traceSeqNo\"\n                :label=\"'主流水'\">\n                <template slot-scope=\"props\">\n                    {{props.row.seqNo}}\n                </template>\n            </el-table-column>\n            <el-table-column\n                align=\"center\"\n                min-width=\"150\"\n                prop=\"traceSeqNo\"\n                :label=\"'服务码'\">\n                <template slot-scope=\"props\">\n                    {{props.row.serviceCode}}\n                </template>\n            </el-table-column>\n            <el-table-column\n                align=\"center\"\n                width=\"150\"\n                prop=\"traceSeqNo\"\n                :label=\"'请求时间'\">\n                <template slot-scope=\"props\">\n                    {{props.row.cs}}\n                </template>\n            </el-table-column>\n            <el-table-column\n                align=\"center\"\n                width=\"150\"\n                prop=\"traceSeqNo\"\n                :label=\"'响应时间'\">\n                <template slot-scope=\"props\">\n                    {{props.row.ss}}\n                </template>\n            </el-table-column>\n           <el-table-column\n                align=\"center\"\n                width=\"130\"\n                prop=\"traceSeqNo\"\n                :label=\"'返回码'\">\n                <template slot-scope=\"props\">\n                    {{props.row.retCode}}\n                </template>\n            </el-table-column>\n            <el-table-column\n                align=\"center\"\n                min-width=\"200\"\n                prop=\"traceSeqNo\"\n                :label=\"'返回信息'\">\n                <template slot-scope=\"props\">\n                    {{props.row.retMsg}}\n                </template>\n            </el-table-column>\n        </el-table>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {SPAN_V1} from '@/utils/spanConverter.js'\nimport skew from '@/utils/skew.js'\nimport {traceSummary, traceSummariesToMustache} from '@/utils/traceSummary.js'\nimport Api from '@/constants/Api.js'\nexport default {\n    name: 'transactionDetails',\n    data () {\n        return {\n            that: this,\n            loading: false,\n            tableBoxParams: ['SEQ_NO', 'SOURCE_TYPE', 'TRAN_TIMESTAMP', 'SERVICE_CODE', 'RET_CODE', 'RET_MSG'],\n            // 查询规则\n            inputRules: {\n                startTs: [\n                    { required: true, message: '请选择时间期限', trigger: 'blur' }\n                ],\n                endTs: [\n                    { required: true, message: '请选择时间期限', trigger: 'blur' }\n                ],\n                serviceName: [\n                    { required: true, message: '请输入服务名', trigger: 'blur' }\n                ],\n                sourceType: [\n                    { required: true, message: '请输入渠道号', trigger: 'blur' }\n                ],\n                limit: [\n                    { required: true, message: '请输入数量', trigger: 'blur' },\n                    { pattern: /^\\+?[1-9][0-9]*$/, message: '数量必须为数字值' }\n                ]\n            },\n            searchFrom: {\n                startTs: new Date().getTime() - 86400000,\n                endTs: new Date().getTime(),\n                limit: '10',\n                lookback: '',\n                serviceName: '',\n                sourceType: ''\n            },\n            zipkinData: [], // 未处理数据\n            zipkinTable: [] // 处理完数据\n        }\n    },\n    computed: {\n        ApiQuery() {\n            const query = Object.assign({}, this.searchFrom)\n            query.startTs = new Date(query.startTs).getTime()\n            query.endTs = new Date(query.endTs).getTime()\n            if (query.endTs > query.startTs) {\n                query.lookback = String(query.endTs - query.startTs)\n            }\n            delete query.startTs\n            Object.keys(query).forEach(key => {\n                if (query[key] === '') {\n                    delete query[key]\n                }\n            })\n            return query\n        }\n    },\n    mounted() {\n    },\n    methods: {\n        searchHandle() {\n            const vm = this\n            vm.$refs.searchFrom.validate((valid) => {\n                if (valid) {\n                    vm.searchAxios(vm.ApiQuery, vm.tableBoxParams)\n                } else {\n                    vm.$message({\n                        message: '格式不正确！',\n                        type: 'warning'\n                    })\n                }\n            })\n        },\n        // 搜索封装\n        searchAxios(param, tableParams) {\n            this.loading = true\n            this.$axios.get(Api.zipkinDetailtrace, {\n                params: param\n            }).then((res) => {\n                // console.log(res)\n                if (!res.length > 0 || res === undefined || res === null) {\n                    this.zipkinData = []\n                    this.zipkinTable = []\n                    this.loading = false\n                    this.$message({\n                        type: 'info',\n                        message: '暂无数据'\n                    })\n                    return false\n                }\n                let traces = res\n                this.zipkinData = JSON.parse(JSON.stringify(traces))\n                // console.log({'start': this.zipkinData})\n                const summaries = traces.map(raw => {\n                    const v1Trace = raw.map(SPAN_V1.convert)\n                    // console.log({'one': v1Trace})\n                    const mergedTrace = SPAN_V1.mergeById(v1Trace)\n                    // console.log({'two': mergedTrace})\n                    const clockSkewCorrectedTrace = skew.correctForClockSkew(mergedTrace)\n                    // console.log({'three': clockSkewCorrectedTrace})\n                    return traceSummary(clockSkewCorrectedTrace, tableParams)\n                })\n                let serviceName = null\n                // console.log({'four': summaries})\n                let zipkinData = traceSummariesToMustache(serviceName, summaries)\n                // console.log({'end': this.zipkinTable})\n                let sort = 'Newest-First' // 时间顺序\n                this.sortHandle(zipkinData, sort)\n                function traceParameter(value, parameter) {\n                    if (value) {\n                        return value[parameter] ? value[parameter] : ''\n                    }\n                }\n                function annotationsFilter(value, param, that) {\n                    let time = null\n                    if (Array.isArray(value) && value.length > 0) {\n                        value.forEach((item) => {\n                            if (item.valueName === param) {\n                                time = item.timestamp\n                            }\n                        })\n                    }\n                    if (time) {\n                        return that.$moment(Math.trunc(time / 1000)).format('YYYY-MM-DD HH:mm:ss')\n                    } else {\n                        return ''\n                    }\n                }\n                this.zipkinTable = zipkinData.map(item => {\n                    let span = {\n                        tranTimestamp: traceParameter(item.traceSeqNo, 'TRAN_TIMESTAMP'),\n                        seqNo: traceParameter(item.traceSeqNo, 'SEQ_NO'),\n                        serviceCode: traceParameter(item.traceSeqNo, 'SERVICE_CODE'),\n                        retCode: traceParameter(item.traceSeqNo, 'RET_CODE'),\n                        retMsg: traceParameter(item.traceSeqNo, 'RET_MSG'),\n                        cs: annotationsFilter(item.traceSeqNo.annotations, 'cs', this.that),\n                        ss: annotationsFilter(item.traceSeqNo.annotations, 'ss', this.that)\n                    }\n                    return span\n                })\n                this.loading = false\n            }).catch((error) => {\n                this.zipkinData = []\n                this.zipkinTable = []\n                this.loading = false\n                this.$message.error(error.data.message || error.message || error)\n            })\n        },\n        // 排序\n        sortHandle(arr, val) {\n            let sortFunctions = { // 规则\n                'Service-Percentage:Longest-First': (a, b) => b.percentage - a.percentage,\n                'Service-Percentage:Shortest-First': (a, b) => a.percentage - b.percentage,\n                'Longest-First': (a, b) => b.duration - a.duration,\n                'Shortest-First': (a, b) => a.duration - b.duration,\n                'Newest-First': (a, b) => b.timestamp - a.timestamp,\n                'Oldest-First': (a, b) => a.timestamp - b.timestamp\n            }\n            if (sortFunctions.hasOwnProperty(val)) {\n                arr.sort(sortFunctions[val])\n            }\n        },\n        handleDownload() {\n            this.downloadLoading = true\n            let name = new Date().getTime() + '-zipkin'\n            import('@/utils/exportexcel').then(excel => {\n                const tHeader = ['时间戳', '主流水', '服务码', '请求时间', '响应时间', '返回码', '返回信息']\n                const filterVal = ['tranTimestamp', 'seqNo', 'serviceCode', 'cs', 'ss', 'retCode', 'retMsg']\n                const list = this.zipkinTable\n                const data = this.formatJson(filterVal, list)\n                excel.export_json_to_excel({\n                    header: tHeader,\n                    data,\n                    filename: name,\n                    autoWidth: true\n                })\n                this.downloadLoading = false\n            })\n        },\n        formatJson(filterVal, jsonData) {\n            return jsonData.map(v => filterVal.map(j => {\n                return v[j]\n            }))\n        }\n    }\n}\n\n</script>\n<style lang='scss' scoped>\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/zipkin/transactionDetails.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"transactionDetails\"},[_c('div',{staticClass:\"button-group\"},[_c('span',{staticClass:\"route-name\"},[_vm._v(_vm._s(_vm.$route.meta.title))])]),_vm._v(\" \"),_c('div',{staticClass:\"header\",staticStyle:{\"width\":\"100%\",\"height\":\"100%\"}},[_c('el-form',{ref:\"searchFrom\",attrs:{\"model\":_vm.searchFrom,\"label-width\":\"82px\",\"rules\":_vm.inputRules,\"label-position\":\"left\",\"size\":\"small\"}},[_c('el-row',{attrs:{\"gutter\":12}},[_c('el-col',{attrs:{\"xl\":4,\"lg\":6}},[_c('el-form-item',{attrs:{\"label\":_vm.$t('common.startDate')+'：',\"label-width\":\"92px\",\"prop\":\"startTs\"}},[_c('el-date-picker',{staticStyle:{\"width\":\"100%\"},attrs:{\"type\":\"datetime\",\"placeholder\":_vm.$t('common.selectDate')},model:{value:(_vm.searchFrom.startTs),callback:function ($$v) {_vm.$set(_vm.searchFrom, \"startTs\", $$v)},expression:\"searchFrom.startTs\"}})],1)],1),_vm._v(\" \"),_c('el-col',{attrs:{\"xl\":4,\"lg\":6}},[_c('el-form-item',{attrs:{\"label\":_vm.$t('common.endDate')+'：',\"label-width\":\"92px\",\"prop\":\"endTs\"}},[_c('el-date-picker',{staticStyle:{\"width\":\"100%\"},attrs:{\"type\":\"datetime\",\"placeholder\":_vm.$t('common.selectDate')},model:{value:(_vm.searchFrom.endTs),callback:function ($$v) {_vm.$set(_vm.searchFrom, \"endTs\", $$v)},expression:\"searchFrom.endTs\"}})],1)],1),_vm._v(\" \"),_c('el-col',{attrs:{\"xl\":4,\"lg\":6}},[_c('el-form-item',{attrs:{\"label\":'服务名：',\"label-width\":\"70px\"}},[_c('el-input',{attrs:{\"clearable\":\"\",\"placeholder\":\"eg: MBSD_GA-1400-0101\",\"type\":\"text\",\"maxlength\":\"25\"},model:{value:(_vm.searchFrom.serviceName),callback:function ($$v) {_vm.$set(_vm.searchFrom, \"serviceName\", (typeof $$v === 'string'? $$v.trim(): $$v))},expression:\"searchFrom.serviceName\"}})],1)],1),_vm._v(\" \"),_c('el-col',{attrs:{\"xl\":4,\"lg\":6}},[_c('el-form-item',{attrs:{\"label\":'渠道：',\"label-width\":\"56px\"}},[_c('el-input',{attrs:{\"clearable\":\"\",\"placeholder\":\"eg: MT\",\"type\":\"text\",\"maxlength\":\"25\"},model:{value:(_vm.searchFrom.sourceType),callback:function ($$v) {_vm.$set(_vm.searchFrom, \"sourceType\", (typeof $$v === 'string'? $$v.trim(): $$v))},expression:\"searchFrom.sourceType\"}})],1)],1)],1),_vm._v(\" \"),_c('el-row',{attrs:{\"gutter\":12}},[_c('el-col',{attrs:{\"xl\":4,\"lg\":6}},[_c('el-form-item',{attrs:{\"label\":'查询数量：',\"label-width\":\"92px\",\"prop\":\"limit\"}},[_c('el-input',{attrs:{\"clearable\":\"\",\"type\":\"text\",\"maxlength\":\"25\"},model:{value:(_vm.searchFrom.limit),callback:function ($$v) {_vm.$set(_vm.searchFrom, \"limit\", (typeof $$v === 'string'? $$v.trim(): $$v))},expression:\"searchFrom.limit\"}})],1)],1),_vm._v(\" \"),_c('el-col',{staticStyle:{\"min-width\":\"155px\"},attrs:{\"xl\":3,\"lg\":3}},[_c('el-form-item',{attrs:{\"label\":'',\"label-width\":\"0px\"}},[_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"small\"},on:{\"click\":function($event){_vm.searchHandle()}}},[_vm._v(_vm._s(_vm.$t('common.search')))]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"small\"},on:{\"click\":function($event){_vm.handleDownload()}}},[_vm._v(\"下载\")])],1)],1)],1)],1)],1),_vm._v(\" \"),_c('div',[_c('el-table',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],ref:\"multipleTable\",staticStyle:{\"width\":\"100%\"},attrs:{\"stripe\":\"\",\"data\":_vm.zipkinTable,\"size\":\"small\"}},[_c('el-table-column',{attrs:{\"align\":\"center\",\"width\":\"100\",\"prop\":\"traceSeqNo\",\"label\":'时间戳'},scopedSlots:_vm._u([{key:\"default\",fn:function(props){return [_vm._v(\"\\n                  \"+_vm._s(props.row.tranTimestamp)+\"\\n              \")]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"align\":\"center\",\"width\":\"100\",\"prop\":\"traceSeqNo\",\"label\":'主流水'},scopedSlots:_vm._u([{key:\"default\",fn:function(props){return [_vm._v(\"\\n                  \"+_vm._s(props.row.seqNo)+\"\\n              \")]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"align\":\"center\",\"min-width\":\"150\",\"prop\":\"traceSeqNo\",\"label\":'服务码'},scopedSlots:_vm._u([{key:\"default\",fn:function(props){return [_vm._v(\"\\n                  \"+_vm._s(props.row.serviceCode)+\"\\n              \")]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"align\":\"center\",\"width\":\"150\",\"prop\":\"traceSeqNo\",\"label\":'请求时间'},scopedSlots:_vm._u([{key:\"default\",fn:function(props){return [_vm._v(\"\\n                  \"+_vm._s(props.row.cs)+\"\\n              \")]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"align\":\"center\",\"width\":\"150\",\"prop\":\"traceSeqNo\",\"label\":'响应时间'},scopedSlots:_vm._u([{key:\"default\",fn:function(props){return [_vm._v(\"\\n                  \"+_vm._s(props.row.ss)+\"\\n              \")]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"align\":\"center\",\"width\":\"130\",\"prop\":\"traceSeqNo\",\"label\":'返回码'},scopedSlots:_vm._u([{key:\"default\",fn:function(props){return [_vm._v(\"\\n                  \"+_vm._s(props.row.retCode)+\"\\n              \")]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"align\":\"center\",\"min-width\":\"200\",\"prop\":\"traceSeqNo\",\"label\":'返回信息'},scopedSlots:_vm._u([{key:\"default\",fn:function(props){return [_vm._v(\"\\n                  \"+_vm._s(props.row.retMsg)+\"\\n              \")]}}])})],1)],1)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-f6f441b2\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/zipkin/transactionDetails.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-f6f441b2\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./transactionDetails.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./transactionDetails.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./transactionDetails.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-f6f441b2\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./transactionDetails.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-f6f441b2\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/zipkin/transactionDetails.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}